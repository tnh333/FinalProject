<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>US Housing Market</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <!-- include google web fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web|Oswald" rel="stylesheet">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet">
    <!-- include icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/c3.min.css">
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>
    <!-- include c3.js to make charts. c3.js is built upon d3.js -->
    <script src="js/d3.js"></script>
    <script src="js/c3.min.js"></script>
</head>

<body>
    <!-- sidebar -->
    <div id="info">
        <div id="title">
            Housing Market in the United States
            <div class="right">
                <div id="link-holder">
                    <span><a href="https://github.com/tnh333/covidhousingmarket" target="_blank"><i class="bi bi-github"></i></a></span>
                    <button class="button" onclick="window.location.href = 'about.html'">About</button>
                    <button class="button" onclick="window.location.href = 'info.html'">More Info</button>
                </div>
            </div>
        </div>
        <div id="count" class="card">
            <h5 id="desc">Click on the different buttons below to see the similarities and differences between the phenomenon</h5>
        </div>
        <div id="buttons">
            <button class="button" onclick="window.location.href = 'map1.html'">Whole US Housing</button>
            <button class="button" onclick="window.location.href = 'map1.html'">Pre-Covid West</button>
            <button class="button" onclick="window.location.href = 'map1.html'">Post-Covid West</button>
            <button class="button" onclick="window.location.href = 'map1.html'">Pre-Covid East</button>
            <button class="button" onclick="window.location.href = 'map1.html'">Post-Covid East</button>
        </div>

        <div id="footer">
            The significance of this project is to show any changes within this market before and after covid, 
            while also comparing the East and West coast markets. This will be beneficial for buyers and sellers to find the best
             place to participate in the market. Also, people interested in this topic can draw conclusions about the East and West markets.
        </div>
    </div>
    <div id="map"></div>
        
    <div id="legend"></div>
    <script>
        mapboxgl.accessToken =
            'pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw';
        let map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/dark-v10',
            zoom: 3, // starting zoom
            center: [-113, 40], // starting center
            projection: 'albers'
        });

        const Mean = [100000, 150000, 250000],
            colors = ['rgb(153,204,255)', 'rgb(51, 153, 255)', 'rgb(0, 76, 153)'],
            radii = [3, 15, 20];

        //load data to the map as new layers.
        //map.on('load', function loadingData() {
        map.on('load', () => { //simplifying the function statement: arrow with brackets to define a function

            // when loading a geojson, there are two steps
            // add a source of the data and then add the layer out of the source
            map.addSource('US-housing', {
                type: 'geojson',
                data: 'assets/us-house.geojson'
            });

            map.addLayer({
                    'id': 'us-house-layer',
                    'type': 'circle',
                    'source': 'US-housing',
                    'paint': {
                        // increase the radii of the circle as the zoom level and dbh value increases
                        'circle-radius': {
                            'property': 'Mean',
                            'stops': [
                                [{
                                    zoom: 5,
                                    value: Mean[0]
                                }, radii[0]],
                                [{
                                    zoom: 5,
                                    value: Mean[1]
                                }, radii[1]],
                                [{
                                    zoom: 5,
                                    value: Mean[2]
                                }, radii[2]]
                            ]
                        },
                        'circle-color': {
                            'property': 'Mean',
                            'stops': [
                                [Mean[0], colors[0]],
                                [Mean[1], colors[1]],
                                [Mean[2], colors[2]]
                            ]
                        },
                        'circle-stroke-color': 'gray',
                        'circle-stroke-width': 1,
                        'circle-opacity': 0.6
                    }
                },
                'waterway-label'
            );


            // click on tree to view magnitude in a popup
            map.on('click', 'us-house-layer', (event) => {
                new mapboxgl.Popup()
                    .setLngLat(event.features[0].geometry.coordinates)
                    .setHTML(`<strong>County:</strong> ${event.features[0].properties.County} <br> <strong>Mean Price: $</strong> ${event.features[0].properties.Mean}`)
                    .addTo(map);
            });

        });


        // create legend
        
        const legend = document.getElementById('legend');

        //set up legend grades and labels
        var labels = ['<strong>House Price (avg)</strong>'],
            vbreak;
        //iterate through grades and create a scaled circle and label for each
        for (var i = 0; i < Mean.length; i++) {
            vbreak = Mean[i];
            // you need to manually adjust the radius of each dot on the legend 
            // in order to make sure the legend can be properly referred to the dot on the map.
            dot_radii = 2 * radii[i];
            labels.push(
                '<p class="break"><i class="dot" style="background:' + colors[i] + '; width: ' + dot_radii +
                'px; height: ' +
                dot_radii + 'px; "></i> <span class="dot-label" style="top: ' + dot_radii / 2 + 'px;">' + vbreak +
                '</span></p>');

        }
        
        // add the data source
        const source =
            '<p style="text-align: right; font-size:10pt">Source: <a href="https://www.kaggle.com/datasets/goldenoakresearch/us-household-income-stats-geo-locations?select=kaggle_income.csv">Kaggle</a></p>';
        // combine all the html codes.
        legend.innerHTML = labels.join('') + source;
    </script>

    <script src="js/main.js"></script>
</body>

</html>